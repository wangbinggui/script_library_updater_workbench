# 话术示例库更新校验工具

一个基于Flask和pandas的Web应用，用于自动更新话术示例并进行人工校验，判定最终是否更新以及人工修正更新内容。

## 功能特性

### 核心功能
1. **Excel文件上传**：支持上传包含对话数据的Excel表格，拖拽上传更便捷
2. **智能对比**：按标点符号分割进行精确差异对比，智能高亮显示变化
3. **人工校验**：支持采纳、拒绝或手动编辑每一句话术
4. **会话管理**：每通对话可独立保存校验结果
5. **分类统计**：实时显示4类对话统计（已保存/未保存 × 有变更/无变更）
6. **进度跟踪**：实时显示校验进度和会话状态
7. **结果导出**：生成包含人工校验结果的Excel文件，支持中文文件名

### 支持的数据格式
Excel表格需包含以下列：
- `sessionId`：会话ID
- `角色`：客服/客户
- `话术内容`：原始话术
- `变更后的内容`：自动更新后的话术
- `更新情况`：更新状态说明
- `LLM完整输出`：大模型输出的完整信息
- `更新结果检查`：自动检查结果
- `更新结果检查详情`：检查详情说明

## 安装和运行

### 环境要求
- Python 3.7+
- Flask 2.3.3
- pandas 2.1.0
- openpyxl 3.1.2

### 安装步骤

1. **克隆项目**
```bash
git clone <repository-url>
cd script_library_updater_workbench
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **运行应用**
```bash
python app.py
```

4. **访问应用**
打开浏览器访问：`http://localhost:5000`

## 使用说明

### 1. 加载Excel文件

项目支持两种方式加载Excel文件：

#### 📁 文件上传方式
- 点击"文件上传"选项卡（默认选中）
- 点击上传区域选择Excel文件（支持.xlsx和.xls格式）
- 或直接拖拽文件到上传区域
- 系统会自动验证文件格式和必需列

#### 🔗 文件路径方式
- 点击"文件路径"选项卡
- 在输入框中输入Excel文件的完整路径
- 支持绝对路径（如：`C:\data\example.xlsx`）和相对路径（如：`./data/example.xlsx`）
- 点击"加载文件"按钮直接从指定路径加载
- 适用于服务器环境或已知文件位置的场景

### 2. 对话校验
- 系统按sessionId分组显示每通对话，显示会话ID
- 紧凑的一行式布局：角色标签、元数据信息、操作按钮水平排列
- 左侧显示原始内容，右侧显示更新后内容
- **智能差异标红**：按标点符号精确对比，只标红真正不同的句子
- 元数据信息：更新情况、更新结果检查（问题时大红色警告）
- **弹窗查看详情**：LLM完整输出和检查详情支持点击弹窗查看

### 3. 人工操作
每一行话术支持三种操作：
- **采纳**：使用自动更新后的内容
- **拒绝**：保留原始内容  
- **编辑**：打开模态框编辑器进行自定义修改

### 4. 会话保存
- **保存按钮**：每通对话完成校验后可点击保存
- **状态管理**：已保存的会话按钮变为"已保存"状态
- **智能分类**：自动将对话分为4类并实时统计

### 5. 导航和进度
- 使用"上一通"/"下一通"按钮切换对话
- 实时查看校验进度（已完成/总数）
- **统计面板**：显示4类对话统计
  - 🟢 已保存-无变更
  - 🔵 已保存-有变更  
  - 🟡 未保存-无变更
  - 🔴 未保存-有变更

### 6. 导出结果
- 随时点击"生成更新后的表格"导出结果
- 导出的Excel包含原有列及新增的"人工校验修正后的内容"列
- 支持中文文件名，自动添加时间戳

## 项目结构

```
script_library_updater_workbench/
├── app.py                 # Flask应用主文件
├── requirements.txt       # 依赖包列表
├── README.md             # 项目说明文档
├── templates/
│   └── index.html        # 前端页面模板
├── static/
│   ├── css/
│   │   └── style.css     # 样式文件
│   └── js/
│       └── script.js     # 前端JavaScript逻辑
└── uploads/              # 上传文件存储目录
```

## 技术架构

### 后端 (Flask)
- **文件处理**：使用pandas读取和处理Excel文件
- **数据管理**：内存中存储当前会话数据
- **API接口**：提供文件上传、数据获取、更新操作等RESTful接口

### 前端 (HTML/CSS/JavaScript)
- **响应式设计**：支持PC和移动端访问
- **交互体验**：拖拽上传、模态框编辑、实时反馈
- **差异显示**：智能高亮显示文本差异

## 特色功能

### 🎯 智能差异对比
- **按句分析**：以标点符号为分隔，逐句精确对比
- **算法优化**：使用最长公共子序列(LCS)算法，准确识别增删改
- **双侧标红**：左右两侧对应显示，相同部分不标红，不同部分精确标红
- **示例效果**：能准确识别"25款→26款"的变更和句子的删除

### 🔴 问题预警系统  
- **大红色警告**：更新结果检查有问题时，以显眼的红色背景警告
- **详情弹窗**：LLM输出和检查详情支持弹窗查看，不占用界面空间
- **一键查看**：点击即可查看完整的检查详情和LLM分析结果

### 📊 智能分类统计
- **4类自动分类**：根据保存状态和变更情况自动分类
- **实时统计**：统计面板实时更新各类对话数量
- **进度可视化**：彩色标签直观显示对话状态

### 💾 会话状态管理
- **独立保存**：每通对话可独立保存校验结果
- **状态跟踪**：保存后自动更新对话分类和按钮状态
- **数据持久**：校验过程中的所有修改实时保存

### 🎨 现代化界面
- **紧凑布局**：一行式元数据和操作按钮，最大化内容显示空间
- **响应式设计**：支持PC和移动端，自适应屏幕尺寸
- **交互优化**：拖拽上传、模态框编辑、即时反馈

## 注意事项

1. 上传的Excel文件必须包含所有必需的列
2. 文件大小限制为16MB
3. 建议使用现代浏览器以获得最佳体验
4. 校验过程中的数据变更会实时保存

## 开发和扩展

本项目采用模块化设计，便于扩展和维护：
- 后端API可以独立扩展新功能
- 前端组件化设计，易于添加新的交互功能
- 支持自定义样式和主题

## 许可证

本项目采用MIT许可证。详见LICENSE文件。
